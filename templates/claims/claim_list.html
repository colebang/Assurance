{% extends 'base.html' %}
{% load accounts_extras %}
{% block title %}Claims{% endblock %}
{% block content %}
<h2>Claims</h2>
<form method="get">
  {{ filter.form.as_p }}
  <button type="submit">Filter</button>
</form>
<table class="datatable">
  <thead>
    <tr>
      <th>Code</th>
      <th>Assuré</th>
      <th>Produit</th>
      <th>Statut</th>
      <th>Montant facture</th>
      {% if not user|has_group:'redacteur' %}
      <th>Remboursable</th>
      {% endif %}
      <th>Déclaré le</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for claim in claims %}
    <tr>
      <td>{{ claim.public_code }}</td>
      <td>{{ claim.policy.insured }}</td>
      <td>{{ claim.policy.product.name }}</td>
      <td>{{ claim.status }}</td>
      <td>{{ claim.invoice_amount }}</td>
      {% if not user|has_group:'redacteur' %}
      <td>{{ claim.reimbursable_amount }}</td>
      {% endif %}
      <td>{{ claim.declared_at }}</td>
      <td><a href="{% url 'claims:claim_detail' claim.pk %}">Detail</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<a href="{% url 'claims:claim_create' %}">New claim</a>
{% endblock %}
